# 前言

> 消息幂等表

# 消息幂等表

消息幂等表是用于确保消息处理过程中的幂等性的数据库表设计

幂等性是指同样的操作执行多次的结果与执行一次的结果相同

在消息队列和分布式系统中，由于网络延迟、故障等因素，可能会出现消息重复发送的情况

为了确保即使消息被重复处理也不会影响最终结果的一致性，就需要设计一个能够记录已处理消息的状态的表

> 消息幂等表 message_idempotency

 字段               | 类型       | 描述                                         
------------------|----------|--------------------------------------------
 ID               | VARCHAR  | 主键，唯一标识每条记录                                
 MESSAGE_ID       | VARCHAR  | 消息的唯一标识符，用于关联外部系统中的消息                      
 MESSAGE_PAYLOAD  | TEXT     | 消息的实际内容或负载                                 
 STATUS           | VARCHAR  | 消息当前的状态，例如 "INIT", "PROCESSED", "FAILED" 等 
 PROCESSED_TIME   | DATETIME | 消息被成功处理的时间戳                                
 ERROR_MESSAGE    | TEXT     | 如果消息处理失败，记录错误消息或堆栈跟踪                       
 CREATE_TIME      | DATETIME | 记录消息创建的时间                                  
 UPDATE_TIME      | DATETIME | 记录最后一次更新的时间                                


> 索引设计

- 主键索引 (id): 唯一标识每条记录
- 唯一索引 (message_id): 防止重复消息
- 状态索引 (status): 加快按状态查询的速度
- 处理时间索引 (processed_at): 用于按处理时间查询

> 注意事项

- 性能优化：确保对常用查询字段添加索引
- 数据一致性：使用事务来保证数据的一致性
- 幂等性保证：确保消息处理逻辑是幂等的，即多次处理同一消息不会产生不同的结果
- 扩展性：考虑未来的扩展需求，比如分布式部署时如何处理消息分配和状态同步